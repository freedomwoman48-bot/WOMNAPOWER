<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סכנה! ספר הבישול שלך עלול לגרום לשוויון</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Style for the chat window */
        #chat-window {
            transition: all 0.3s ease-in-out;
        }
        .message-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            align-self: flex-start; /* For LTR this would be flex-end */
        }
        .bot-message {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
            align-self: flex-end; /* For LTR this would be flex-start */
        }
        /* Scrollbar styles for chat */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 3px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header Section -->
    <header class="bg-rose-500 text-white text-center py-16 px-4 fade-in">
        <h1 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-lg">סכנה! ספר הבישול הזה עלול לגרום לשוויון</h1>
        <p class="text-lg md:text-2xl max-w-3xl mx-auto">ולמה זה הדבר הכי מדהים שיקרה לכם במטבח</p>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        
        <!-- Absurd Exaggerations Section -->
        <section class="mb-16 fade-in" style="animation-delay: 200ms;">
            <h2 class="text-3xl font-bold text-center mb-8 text-rose-600">האסון: גברים במטבח - האם סוף העולם קרוב?</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-xl mb-3">ערעור יסודות הפטריארכיה</h3>
                    <p>דו"ח מיוחד קובע: השימוש הגברי בפפריקה מתוקה גורם לשיבושים קוונטיים במרקם הזמן-חלל הפטריארכלי. כל קורטוב נוסף מקרב אותנו לקראת עולם שבו זוג גרביים לא צריך הוראות הפעלה.</p>
                </div>
                <!-- Card 2 -->
                <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-xl mb-3">התפתחות רגשית מסוכנת</h3>
                    <p>תופעה מדאיגה: גברים מפתחים יכולת להבחין בין פטרוזיליה לכוסברה. מדענים חוששים שזהו השלב הראשון בדרך להבנה של מה זה "לא להשאיר כלים בכיור". התוצאות עלולות להיות הרסניות.</p>
                </div>
                <!-- Card 3 -->
                <div class="bg-white p-6 rounded-lg shadow-lg border border-slate-200 hover:shadow-xl transition-shadow">
                    <h3 class="font-bold text-xl mb-3">הפרדוקס של הקיש</h3>
                    <p>מה יקרה אם גבר יכין קיש? האם היקום יקרוס לתוך עצמו בחור שחור של בצק פריך? עדיין אין לנו תשובה, אבל אנחנו מעדיפים לא לקחת את הסיכון. נא להמשיך בחذر.</p>
                </div>
            </div>
        </section>

        <!-- The Real Message Section -->
        <section class="bg-slate-100 rounded-lg p-8 md:p-12 fade-in" style="animation-delay: 400ms;">
            <h2 class="text-3xl font-bold text-center mb-8 text-rose-600">מרד המריות: למה ספר בישול הוא הנשק הסודי שלכם</h2>
            <div class="max-w-3xl mx-auto space-y-6 text-center text-lg">
                <p class="leading-relaxed">בואו נודה באמת, הרעיון שרק חצי מהאוכלוסייה יודע להפעיל תנור הוא לא רק מיושן, הוא גם ממש לא יעיל. תחשבו על כל האוכל הפוטנציאלי שאנחנו מפספסים!</p>
                <p class="font-bold text-xl bg-rose-100 p-4 rounded-md">בישול הוא כימיה, פיזיקה ואומנות. לא כרומוזומים.</p>
                <p class="leading-relaxed">ספר בישול הוא בסך הכל מדריך למשתמש. כמו לרהיט מאיקאה, רק שבסוף יוצא משהו טעים ולא מדף עקום עם בורג ספייר. כל אחד ואחת יכולים לעקוב אחרי הוראות.</p>
                <p class="italic p-4 border-r-4 border-rose-400 bg-white shadow-sm">"תנו לגבר ספר בישול, והוא יאכל ליום אחד. למדו אותו שזה בסדר גמור להשתמש בו, ותרוויחו שותף שווה במטבח (ואולי, רק אולי, גם מישהו שישטוף כלים)."</p>
            </div>
        </section>

    </main>

    <!-- Chatbot -->
    <div id="chatbot-container" class="fixed bottom-5 left-5 z-50">
        <!-- Chat toggle button -->
        <button id="chat-toggle" class="bg-rose-500 text-white rounded-full p-4 shadow-lg hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 transition-transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
        </button>

        <!-- Chat window -->
        <div id="chat-window" class="absolute bottom-20 left-0 w-80 sm:w-96 h-[500px] bg-white rounded-lg shadow-2xl flex flex-col transform scale-95 opacity-0 pointer-events-none">
            <header class="bg-rose-500 text-white p-4 rounded-t-lg flex justify-between items-center">
                <h3 class="font-bold text-lg">שאל/י את מהפכנית המטבח</h3>
                <button id="chat-close" class="text-white hover:text-rose-200">&times;</button>
            </header>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto flex flex-col-reverse">
                <!-- Messages will be appended here -->
                 <div class="flex flex-col items-end space-y-2">
                    <div class="bot-message p-3 rounded-lg message-bubble">
                        <p>שלום! אני כאן כדי לנפץ תקרות זכוכית וקליפות ביצים. במה אוכל לעזור לך לחולל מהפכה במטבח היום?</p>
                    </div>
                </div>
            </div>
            <div id="loading-indicator" class="p-4 text-center hidden">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-rose-500 mx-auto"></div>
            </div>
            <footer class="p-2 border-t border-slate-200">
                <div class="flex">
                    <input type="text" id="chat-input" placeholder="כתוב/י הודעה..." class="flex-1 p-2 border border-slate-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-rose-500">
                    <button id="chat-send" class="bg-rose-500 text-white p-3 rounded-r-md hover:bg-rose-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform -rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                    </button>
                </div>
            </footer>
        </div>
    </div>


    <script>
        // --- Chatbot UI Logic ---
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const chatClose = document.getElementById('chat-close');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        const loadingIndicator = document.getElementById('loading-indicator');

        const toggleChatWindow = () => {
            if (chatWindow.classList.contains('opacity-0')) {
                chatWindow.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
                chatWindow.classList.add('opacity-100', 'scale-100');
                chatInput.focus();
            } else {
                chatWindow.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                chatWindow.classList.remove('opacity-100', 'scale-100');
            }
        };

        chatToggle.addEventListener('click', toggleChatWindow);
        chatClose.addEventListener('click', toggleChatWindow);

        // --- Chatbot API Logic ---
        const apiKey = "AIzaSyDkm0NzlUH8M6rr77BqST2q2Sp8ukj9S7w"; // API key will be injected by the environment.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const systemPrompt = `את צ'אטבוטית פמיניסטית קיצונית. שמך הוא "מהפכנית המטבח". המטרה שלך היא לענות על שאלות בנוגע לשוויון מגדרי במטבח, החשיבות של פמיניזם, וההשלכות ההרסניות של שובניזם. השתמשי בהומור, סרקזם והגזמות כדי להעביר את הנקודה שלך. אל תתנצלי על דעותייך. כל שיחה חייבת, בסופו של דבר, להתקשר חזרה לכך שבישול הוא מיומנות אנושית אוניברסלית, לא חובה נשית. עני בעברית רהוטה ולוחמנית.`;

        const addMessage = (text, sender) => {
            const messageContainer = document.createElement('div');
            messageContainer.className = 'flex flex-col items-start space-y-2';

            const messageWrapper = document.createElement('div');
            messageWrapper.className = `p-3 rounded-lg message-bubble ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            messageWrapper.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`;

            // This aligns user to the left and bot to the right (flex-start/end in RTL)
            if (sender === 'user') {
                 messageWrapper.classList.add('self-start')
            } else {
                 messageWrapper.classList.add('self-end')
            }

            messageContainer.appendChild(messageWrapper);
            
            // We prepend because the container is flex-col-reverse
            chatMessages.prepend(messageContainer);
        };

        const handleSendMessage = async () => {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            addMessage(userMessage, 'user');
            chatInput.value = '';
            loadingIndicator.classList.remove('hidden');

            try {
                const botResponse = await callGeminiAPI(userMessage);
                addMessage(botResponse, 'bot');
            } catch (error) {
                console.error("Gemini API Error:", error);
                addMessage("אופס, נראה שיש הפרעות פטריארכליות על הקו. נסי שוב בעוד רגע.", 'bot');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        };

        // Function to call Gemini API with exponential backoff
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return response.json();
                    }
                    // Handle non-OK responses that aren't network errors
                    if (response.status === 429 || response.status >= 500) {
                         // Throttling or server error, worth retrying
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    // FIX: For other client-side errors (4xx), the response body might not be JSON.
                    // Read it as text first to avoid a JSON parsing error.
                    const errorText = await response.text();
                    try {
                        // If the error text is valid JSON, parse and return it.
                        const errorData = JSON.parse(errorText);
                        console.error("Non-retriable API error:", errorData);
                        return errorData;
                    } catch (e) {
                        // If it's not JSON, throw an error with the raw text.
                        console.error("Non-retriable API error (not JSON):", errorText);
                        throw new Error(errorText || `Request failed with status ${response.status}`);
                    }

                } catch (error) {
                    if (i === retries - 1) throw error; // Last attempt, throw error
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }


        const callGeminiAPI = async (userQuery) => {
            const payload = {
                contents: [{
                    parts: [{ text: userQuery }]
                }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const result = await fetchWithRetry(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (result && result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Invalid response structure from Gemini API:", result);
                throw new Error("לא קיבלתי תשובה מהפכנית מספיק מהשרת. נראה שמישהו שם צריך לעבור סדנת מודעות.");
            }
        };

        chatSend.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSendMessage();
            }
        });
    </script>
</body>
</html>

